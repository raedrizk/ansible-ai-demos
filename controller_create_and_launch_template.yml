---
- name: Create and Launch a Job template for an I generated playbook
  hosts: all
  gather_facts: false
  tasks:
  - name: Add project
    ansible.controller.project:
      name: "AI Generated Playbooks"
      description: "Playbooks generated by Lightspeed"
      organization: "{{ input_organization | default('Foxhound') }}"
      scm_type: git
      scm_url: "{{ input_git_repo | default('https://github.com/raedrizk/ansible_ai_generated_playbooks.git') }}"
      scm_branch: "{{ input_git_branch | default('main') }}"
      update_project: true
      state: present

  - name: Create job template from the generated playbook
    ansible.controller.job_template:
      name: "AI Generated Playbook"
      job_type: "run"
      organization: "{{ input_organization | default('Foxhound') }}"
      inventory: "{{ input_inventory | default('Foxhound Inventory') }}"
      limit: "{{ input_limit | default('api.foxhound.unit') }}"
      project: "AI Generated Playbooks"
      playbook: "{{ generated_playbook_name | default('generated_playbook.yml') }}"
      become_enabled: true
      credentials:
        - "{{ input_credential | default('foxhound-lab-admin') }}"
        - "{{ input_credential_2 | default(omit) }}"
        - "{{ input_credential_3 | default(omit) }}"
      state: present



